{% extends "base.html" %}
{% block title %}{{ package.package_name }} | TrippyPick{% endblock %}

{% block head %}
  {{ super() }}
  {# Link to the new external CSS file #}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}

{% block content %}
<div id="package-detail-page">
  <div class="detail-container">
    
    <div class="main-content">
      <div class="package-header">
        <h1>{{ package.package_name }}</h1>
      </div>

      <div class="package-image">
        {% if package.destination_img %}
            <img src="{{ url_for('static', filename=package.destination_img.replace('static/', '')) }}" alt="{{ package.package_name }}">
        {% else %}
            <div class="image-placeholder"><i class="fas fa-image"></i></div>
        {% endif %}
      </div>

      {# --- TAB STRUCTURE STARTS HERE --- #}
      <div class="content-tabs">
          <div class="tab-header">
              <button class="tab-link active" data-tab="overview">Overview</button>
              <button class="tab-link" data-tab="itinerary">Itinerary</button>
              <button class="tab-link" data-tab="reviews">Reviews</button>
          </div>
          
          <div class="tab-content-container">
              {# --- Overview Tab Content --- #}
              <div id="overview" class="tab-pane active">
                  <div class="description-card">
                      <h2>Description</h2>
                      <p>{{ package.description or 'No description available for this package yet.' }}</p>
                  </div>
                  <div class="highlights-card">
                      <h2>Highlights</h2>
                      <ul>
                        {% for highlight in (package.highlights or '').split(',') %}
                          {% if highlight.strip() %}
                            <li><i class="fas fa-check"></i> {{ highlight.strip() }}</li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                  </div>
                  <div class="inclusions-grid">
                      <div class="inclusion-card included">
                          <h3>What's Included</h3>
                          <ul>
                            {% for item in (package.inclusions_detailed or '').split(',') %}
                                {% if item.strip() %}
                                  <li><i class="fas fa-check"></i> {{ item.strip() }}</li>
                                {% endif %}
                            {% endfor %}
                          </ul>
                      </div>
                      <div class="inclusion-card not-included">
                          <h3>Not Included</h3>
                          <ul>
                            {% for item in (package.exclusions_detailed or '').split(',') %}
                                {% if item.strip() %}
                                  <li><i class="fas fa-times"></i> {{ item.strip() }}</li>
                                {% endif %}
                            {% endfor %}
                          </ul>
                      </div>
                  </div>
              </div>

              {# --- Itinerary Tab Content --- #}
              <div id="itinerary" class="tab-pane">
                  {% if itinerary %}
                    {% for day in itinerary %}
                    <div class="itinerary-day">
                        <div class="day-number">{{ day.day_number }}</div>
                        <div class="day-details">
                            <h3>{{ day.title }}</h3>
                            <p>{{ day.description }}</p>
                        </div>
                    </div>
                    {% endfor %}
                  {% else %}
                    <p>No detailed itinerary available for this package.</p>
                  {% endif %}
              </div>

              {# --- Reviews Tab Content --- #}
              <div id="reviews" class="tab-pane">
                  <div class="reviews-summary">
                      <div class="overall-rating">
                          <div class="rating-value">4.8</div>
                          <div class="stars">â˜…â˜…â˜…â˜…â˜†</div>
                          <div class="review-count">124 reviews</div>
                      </div>
                      <div class="rating-breakdown">
                          <div class="bar-row"><span class="bar-label">5â˜…</span><div class="bar-container"><div class="bar-fill" style="width: 70%;"></div></div><span class="bar-percent">70%</span></div>
                          <div class="bar-row"><span class="bar-label">4â˜…</span><div class="bar-container"><div class="bar-fill" style="width: 20%;"></div></div><span class="bar-percent">20%</span></div>
                          <div class="bar-row"><span class="bar-label">3â˜…</span><div class="bar-container"><div class="bar-fill" style="width: 8%;"></div></div><span class="bar-percent">8%</span></div>
                          <div class="bar-row"><span class="bar-label">2â˜…</span><div class="bar-container"><div class="bar-fill" style="width: 2%;"></div></div><span class="bar-percent">2%</span></div>
                          <div class="bar-row"><span class="bar-label">1â˜…</span><div class="bar-container"><div class="bar-fill" style="width: 1%;"></div></div><span class="bar-percent">1%</span></div>
                      </div>
                  </div>
                  <div class="review-card">
                      <div class="avatar">ðŸ‘¤</div>
                      <div class="review-content">
                          <span class="author">John Doe</span><span class="date">2 weeks ago</span>
                          <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                          <p>Amazing experience! The tour guide was knowledgeable and the accommodations were excellent. The sunrise at Mount Batur was absolutely breathtaking. Highly recommend this package!</p>
                      </div>
                  </div>
                   <div class="review-card">
                      <div class="avatar">ðŸ‘¤</div>
                      <div class="review-content">
                          <span class="author">Jane Smith</span><span class="date">3 weeks ago</span>
                          <div class="stars">â˜…â˜…â˜…â˜…â˜†</div>
                          <p>A really well-organized trip. The Kecak dance was a highlight. Only knocking one star off because the transport was a bit late on one of the days, but overall a fantastic trip.</p>
                      </div>
                  </div>
              </div>
          </div>
      </div>
    </div>

    {# --- SIDEBAR --- #}
    <div class="sidebar">
      <div class="sidebar-card price-card">
        <div class="price-top">
          <span class="current-price">â‚¹{{ "{:,.0f}".format(package.cost_per_package) }}</span>
          {% if package.original_cost and package.original_cost > package.cost_per_package %}
            <span class="original-price">â‚¹{{ "{:,.0f}".format(package.original_cost) }}</span>
            {% set saved = package.original_cost - package.cost_per_package %}
            <span class="save-badge">Save â‚¹{{ "{:,.0f}".format(saved) }}</span>
          {% endif %}
        </div>
        <p class="per-person">per person</p>
        <button class="btn-book-now">Book Now</button>
        <a href="{{ url_for('compare', ids=package.package_id) }}" class="btn-add-compare">Add to Compare</a>
        <p class="cancellation">Free cancellation up to 48 hours</p>
      </div>

      <div class="sidebar-card provider-card">
          <h3>Travel Provider</h3>
          <div class="provider-info">
              <i class="fas fa-user-circle avatar"></i>
              <div class="provider-details">
                  <span class="provider-name">{{ package.agency_name }}</span>
                  {# Add rating and followers if available #}
              </div>
          </div>
          <button class="btn-view-profile">View Profile</button>
      </div>

      <div class="sidebar-card quick-facts-card">
        <h3>Quick Facts</h3>
        <ul>
          <li>
            <span><i class="fas fa-clock"></i> Duration</span>
            <strong>{{ package.days }} days, {{ package.nights }} nights</strong>
          </li>
          <li>
            <span><i class="fas fa-users"></i> Group Size</span>
            <strong>Max {{ package.group_size }} people</strong>
          </li>
        </ul>
      </div>
    </div>

  </div>
</div>

{# Link to the new external JavaScript file #}
<script src="{{ url_for('static', filename='js/package-detail.js') }}"></script>
{% endblock %}
