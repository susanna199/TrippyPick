{% extends "base.html" %}
{% block title %}Compare Packages | TrippyPick{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/compare.css') }}">
{% endblock %}


{% block content %}
<section id="compare-page">
  <div class="compare-header">
    <h1>Compare Packages</h1>
    <p>Compare up to 3 travel packages side by side</p>
  </div>

  {# --- TOP COMPARISON GRID --- #}
  <div class="compare-grid">
    {% for pkg in packages %}
      {% if pkg %}
      <div class="compare-card">
        
        <a href="#" class="btn-remove" data-package-id-remove="{{ pkg.package_id }}" title="Remove from comparison">&times;</a>

        <div class="card-content">
            <div class="image-placeholder">
              {# --- THIS SECTION IS CORRECTED --- #}
              {% if pkg.image_url %}
                <img src="{{ url_for('static', filename=pkg.image_url.replace('static/', '')) }}" alt="{{ pkg.title }}" style="width:100%; height:100%; object-fit: cover; border-radius: 10px;">
              {% else %}
                <span>üñºÔ∏è</span>
              {% endif %}
            </div>
            <h3>{{ pkg.title }}</h3>
            <p class="location">üìç {{ pkg.location }}</p>
            <div class="price">
              <span class="current">‚Çπ{{ "{:,.0f}".format(pkg.price) }}</span>
              <span class="per-person">per person</span>
            </div>
            <p class="duration">üìÖ {{ pkg.duration }}</p>
            <p class="rating">‚≠ê {{ pkg.rating }} <span>({{ pkg.reviews }} reviews)</span></p>
            <p class="group">üë• Max {{ pkg.group_size }}</p>

            <div class="tag-row">
              {% for tag in pkg.tags %}<span class="tag highlight">{{ tag }}</span>{% endfor %}
            </div>

            <div class="includes">
              <h4>What's Included</h4>
              <ul>
                {% for item in pkg.included %}<li>‚úîÔ∏è {{ item }}</li>{% endfor %}
              </ul>
            </div>
            <p class="provider">Provider<br><strong>@{{ pkg.provider }}</strong></p>
        </div>
        <div class="card-actions">
            <button class="btn-details"><a href="{{ url_for('package_detail', package_id=pkg.package_id) }}" class="details-btn">View Details</a>
            </button>
            <button class="btn-book">Book Now</button>
        </div>
      </div>
      {% else %}
      <div class="compare-card empty">
        <div class="add-package">
          <div class="plus-icon">+</div>
          <p>Add Package to Compare</p>
        </div>
      </div>
      {% endif %}
    {% endfor %}
  </div>

  {# --- QUICK COMPARISON TABLE --- #}
  {% if packages[0] and packages[1] %}
  <div class="quick-comparison">
    <h2>Quick Comparison</h2>
    <p class="subtitle">Key differences at a glance</p>
    <table>
        <thead>
            <tr>
                <th>Feature</th>
                {% for pkg in packages %}{% if pkg %}<th>{{ pkg.title }}</th>{% endif %}{% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Best Price</td>
                {% for pkg in packages %}{% if pkg %}
                <td>
                    ‚Çπ{{ "{:,.0f}".format(pkg.price) }}
                    {% if pkg.is_best_price %}<span class="best-badge">Best</span>{% endif %}
                </td>
                {% endif %}{% endfor %}
            </tr>
            <tr>
                <td>Highest Rated</td>
                {% for pkg in packages %}{% if pkg %}
                <td>
                    {{ pkg.rating }}‚òÖ
                    {% if pkg.is_highest_rated %}<span class="best-badge">Best</span>{% endif %}
                </td>
                {% endif %}{% endfor %}
            </tr>
            <tr>
                <td>Value Score</td>
                {% for pkg in packages %}{% if pkg %}<td>{{ pkg.value_score }}</td>{% endif %}{% endfor %}
            </tr>
        </tbody>
    </table>
  </div>
  {% endif %}

  {# --- ADD MORE PACKAGES SECTION --- #}
  <div class="add-more-packages">
      <h2>Add More Packages</h2>
      <div class="search-bar">
          <input type="text" placeholder="Search packages by destination...">
      </div>
      <div class="add-grid">
          {% for pkg_to_add in packages_to_add %}
          <div class="add-card">
              <div class="add-card-image">
                  {# --- THIS SECTION IS CORRECTED --- #}
                  {% if pkg_to_add.image_url %}
                    <img src="{{ url_for('static', filename=pkg_to_add.image_url.replace('static/', '')) }}" alt="{{ pkg_to_add.title }}">
                  {% else %}
                    <span>üñºÔ∏è</span>
                  {% endif %}
              </div>
              <div class="add-card-info">
                  <h4>{{ pkg_to_add.title }}</h4>
                  <p>{{ pkg_to_add.location }}</p>
                  <div class="add-card-price">
                      <strong>‚Çπ{{ "{:,.0f}".format(pkg_to_add.price) }}</strong>
                  </div>
              </div>
              <button class="btn-add" data-package-id-add="{{ pkg_to_add.package_id }}">+ Add</button>
          </div>
          {% endfor %}
      </div>
  </div>

</section>

<script src="{{ url_for('static', filename='js/compare.js') }}"></script>
{% endblock %}
